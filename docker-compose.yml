version: '2'
services:
  git-docker:
    image: "jkarlos/git-server-docker"
    ports:
      - "2222:22"
      - "4443:43"
    volumes:
      - ./git-server/keys:/git-server/keys
      - ./git-server/repos:/git-server/repos
  gocd-server-docker:
    image: "gocd-server-custom:latest"
    ports:
      - "8153:8153"
      - "8154:8154"
    volumes:
      - ./gocd-server/godata:/godata
      - ./gocd-server/home-dir:/home/go
    depends_on:
      - "git-docker"
  gocd-agent1-docker:
    image: "gocd-agent-custom:latest"
    environment:
      - GO_SERVER_URL=https://gocd-server-docker:8154/go
    volumes:
      - ./gocd-agent1/godata:/godata
      - ./gocd-agent1/go:/go
      - ./gocd-agent1/home-dir:/home/go
    depends_on:
      - "git-docker"